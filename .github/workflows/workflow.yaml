name: workflow
on:
  push:
    paths-ignore:
      - "Dockerfile"
      - ".github/workflows/docker.yaml"
    branch:
      - master
  schedule:
    - cron: "0 0 */6 * *"
jobs:
  build:
    runs-on: ubuntu-latest
    container: docker.pkg.github.com/seankhliao/arch-repo/yay:latest
    env:
      PACKAGES: yay-bin google-chrome-dev google-chrome
      repo: seankhliao
    steps:
      - uses: actions/checkout@master

      - run: su -c "yay -S --noconfirm --builddir /home/user/build $PACKAGES" - user
      - run: ls /home/user/build
      - run: bash -c "mkdir pkgs && for pkg in /home/user/build/*; do cp $pkg/*.pkg.zst pkgs; done"
      - run: repo-add -R pkgs/$repo.db.tar.zst pkgs/*.pkg.zst
      - run: git status -s
      - run: git remote set-url origin https://github-actions:${GITHUB_TOKEN}@github.com/seankhliao/arch-repo
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - run: git add pkgs && git commit -m "update pkgs" && git push
