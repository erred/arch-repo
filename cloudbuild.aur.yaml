tags:
  - $COMMIT_SHA
  - $SHORT_SHA
  - arch-repo
  - arch-repo-aur
substitutions:
  _IMG: arch-repo-builder
  _BKT: seankhliao-arch-repo
artifacts:
  objects:
    location: gs://$_BKT
    paths:
      - $_BKT/*

steps:
  - id: warm pkg cache
    name: gcr.io/cloud-builders/gsutil
    args:
      - -m
      - rsync
      - -r
      - gs://$_BKT
      - .

  - id: build pkgs
    timeout: 1200s
    name: gcr.io/$PROJECT_ID/$_IMG:latest
    entrypoint: /usr/bin/bash
    args:
      - ./build.sh
